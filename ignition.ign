{
  "ignition": {
    "config": {},
    "security": {
      "tls": {}
    },
    "timeouts": {},
    "version": "2.3.0"
  },
  "networkd": {},
  "passwd": {
    "users": [
      {
        "name": "core",
        "sshAuthorizedKeys": [
          "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCgakqOKbhaZe7ku2SOmHCrOCeAx//4PQy/nB6jSqIv94yDcyTcnxlJGhcoWdDFUzesFSYLvO63qgm5oA7ApFw413+R/M4FKuq4afhakSn8srthpW1gwI148hF+a8ugcz6h+COXEzOBdJLE0EUGcvKlI79+oF3h/egoO/2gLH0Pi5q5WQxkNXHBLUhZX4jU6uwS22ot4ThiAFKluB+/Asfvbd8ghZ0RDI6Q7H/yAKMp3E/CgA+xFQoTwybcUMm3e6ACJWD00yRczWapwv9ohaINac0ssym/3bFJZArW7foFgI0pyR56/s/0hWaGnA/nsTTHWs/HQ+324opm/a+908zv"
        ]
      }
    ]
  },
  "storage": {
    "files": [
      {
        "filesystem": "root",
        "overwrite": true,
        "path": "/etc/selinux/config",
        "contents": {
          "source": "data:,SELINUX%3Dpermissive%0ASELINUXTYPE%3Dtargeted",
          "verification": {}
        },
        "mode": 420
      },
      {
        "filesystem": "root",
        "group": {
          "name": "root"
        },
        "path": "/opt/bin/k3s",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "https://github.com/rancher/k3s/releases/download/v1.18.6%2Bk3s1/k3s",
          "verification": {
            "hash": "sha512-0951e378d9d1525386e3bc5e067d8f256fe4aed16a5827850736ac223cb211213c48278dacf440694715c045673b583647ef0eb9fcf576dd4cc04685e56ee1f5"
          }
        },
        "mode": 493
      },
      {
        "filesystem": "root",
        "group": {
          "name": "root"
        },
        "path": "/opt/bin/k_params",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "https://raw.githubusercontent.com/mcsaucy/k_params/master/k_params",
          "verification": {}
        },
        "mode": 493
      }
    ],
    "links": [
      {
        "filesystem": "root",
        "path": "/opt/bin/kubectl",
        "target": "/opt/bin/k3s"
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "[Unit]\nDescription=Set hostname based upon kernel commandline\n\n[Install]\nWantedBy=k3s.service\n\n[Service]\nExecStart=/bin/bash -c 'hostnamectl set-hostname --static \"$(/opt/bin/k_params hostname)\"'\nTimeoutStartSec=0\nRestart=on-failure\nRestartSec=5s\n",
        "enabled": true,
        "name": "sethostname.service"
      },
      {
        "contents": "[Unit]\nDescription=Lightweight Kubernetes\nDocumentation=https://k3s.io\nAfter=network-online.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nType=notify\nKillMode=process\nDelegate=yes\nLimitNOFILE=1048576\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nTimeoutStartSec=0\nRestart=always\nRestartSec=5s\nEnvironmentFile=/secrets/k3s_env\nExecStartPre=-/sbin/modprobe br_netfilter\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/opt/bin/k3s server \\\n  --cluster-init \\\n  --cluster-domain example.com \\\n",
        "enabled": true,
        "name": "k3s.service"
      },
      {
        "contents": "[Unit]\nDescription=Papertrail\nAfter=systemd-journald.service\nRequires=systemd-journald.service\n\n[Service]\nEnvironmentFile=/secrets/papertrail_env\nExecStart=/bin/sh -c 'journalctl -f | ncat --ssl \"${PAPERTRAIL_HOST}\" \"${PAPERTRAIL_PORT}\"'\nTimeoutStartSec=0\nRestart=on-failure\nRestartSec=5s\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "papertrail.service"
      },
      {
        "contents": "Description=UptimeRobot Heartbeat\nAfter=systemd-journald.service\nRequires=systemd-journald.service\n\n[Service]\nEnvironmentFile=/secrets/uptimerobot_heartbeat_env\nExecStart=/bin/sh -c 'wget --spider \"https://heartbeat.uptimerobot.com/${UPTIMEROBOT_HEARTBEAT_PATH}\" \u003e/dev/null 2\u003e\u00261'\nTimeoutStartSec=0\nRestart=on-failure\nRestartSec=5s\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "uptimerobot-heartbeat.service"
      },
      {
        "contents": "[Unit]\nDescription=Run UptimeRobot Heartbeat every 5 minutes\nRequires=uptimerobot-heartbeat.service\n\n[Timer]\nUnit=uptimerobot-heartbeat.service\nOnUnitInactiveSec=5m\nAccuracySec=10s\n\n[Install]\nWantedBy=timers.target\n",
        "enabled": true,
        "name": "uptimerobot_heartbeat.timer"
      },
      {
        "contents": "[Unit]\nDescription=Secrets\n\n[Mount]\nWhat=/dev/disk/by-label/secrets\nWhere=/secrets\nOptions=ro\nDirectoryMode=0700\n\n[Install]\nWantedBy=k3s.service\n",
        "enabled": true,
        "name": "secrets.mount"
      }
    ]
  }
}
